

ALTER view [dbo].[M_VITRI_V2] AS SELECT distinct M_VITRI.ID_PTDIEN,M_VITRI.MA_DVQLY,M_VITRI.MA_PTDIEN,M_VITRI.MA_PMIS,CONVERT(VARBINARY(MAX),M_VITRI.TOA_DO)AS TOA_DO,D_CAP_DAP.MA_CAPDA,D_PTDIEN.TEN_PTDIEN,D_PTDIEN.LOAI_PTDIEN,D_PTDIEN.MA_PMISCHA,M_TTHAI_PTDIEN.TRANG_THAI,M_TTHAI_PTDIEN.THOI_DIEM  FROM M_VITRI 
inner join D_PTDIEN on M_VITRI.ID_PTDIEN=D_PTDIEN.ID_PTDIEN
inner join D_CAP_DAP on D_CAP_DAP.MA_CAPDA=D_PTDIEN.MA_CAPDA
inner join M_TTHAI_PTDIEN on M_TTHAI_PTDIEN.ID_PTDIEN=D_PTDIEN.ID_PTDIEN
where M_TTHAI_PTDIEN.THOI_DIEM=(select max(THOI_DIEM) from M_TTHAI_PTDIEN where M_TTHAI_PTDIEN.ID_PTDIEN=D_PTDIEN.ID_PTDIEN);